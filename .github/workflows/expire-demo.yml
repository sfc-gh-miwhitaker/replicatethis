name: Expire Demo Repo

on:
  schedule:
    - cron: "0 7 * * *"
  workflow_dispatch:

jobs:
  expire:
    runs-on: ubuntu-latest
    steps:
      - name: Check expiration
        run: |
          EXPIRATION_DATE="2026-01-07"
          TODAY=$(date -u +"%Y-%m-%d")
          if [[ "$TODAY" > "$EXPIRATION_DATE" ]]; then
            echo "Repository expired on $EXPIRATION_DATE"
          else
            echo "Repository still active (expires $EXPIRATION_DATE)"
          fi
      - name: Archive and make private if expired
        if: ${{ github.event_name == 'schedule' }}
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const expiration = new Date('2026-01-07T00:00:00Z');
            const now = new Date();
            if (now > expiration) {
              await github.rest.repos.update({
                owner: context.repo.owner,
                repo: context.repo.repo,
                private: true,
                archived: true
              });
              core.info('Repository archived and set to private due to expiration.');
            } else {
              core.info('Repository not expired; no action taken.');
            }
